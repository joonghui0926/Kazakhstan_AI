import sensor, image, time, lcd
from maix import KPU
import gc

lcd.init()
sensor.reset()
sensor.set_vflip(1)
sensor.set_pixformat(sensor.RGB565)
sensor.set_framesize(sensor.QVGA)
sensor.skip_frames(time=2000)
clock = time.clock()

kpu = KPU()
kpu.load_kmodel("/sd/Classification/my_classfication.kmodel")

img_proc = image.Image(size=(224, 224), copy_to_fb=False)

class_name = ["train","Motorcycles","ship"]

while True:
    gc.collect()
    img = sensor.snapshot()
    img_proc.draw_image(img, 0,0)
    img_proc.pix_to_ai()

    out = kpu.run_with_output(img_proc, getlist=True)
    max_choice = max(out)
    index = out.index(max_choice)

    print(class_name[index])
    img.draw_string(4,3,class_name[index],color=(0,0,0),scale=2)
    lcd.display(img)

kpu.deinit()
